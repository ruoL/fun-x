<?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');class Link extends A {        private $_prepage = 10;        public function __construct() {        parent::__construct();    }        public function index($start = 0) {        $this->load->library('pagination');        $config['base_url']     = admin_base_url('link/index');        $config['total_rows']   = $this->link_model->get_rows();        $config['per_page']     = $this->_prepage;        $config['num_links']    = 5;        $config['uri_segment']	= 4;        $config['suffix']       = config_item('url_suffix');        $this->pagination->initialize($config);                 $data['pres'] = $this->_prepage;        $data['page'] = $this->pagination->create_links();        $data['rows'] = $config['total_rows'];        $data['list'] = $this->link_model->get_list($start, $config['per_page']);                $this->load->view('admin_link', $data);    }    public function create() {        $this->load->view('admin_link_create');    }        public function update($lid = 0) {            $data['link'] = $this->link_model->get_info(array('lid'=>$lid));                if( ! $data['link'] ) {            show_404();        }                $this->load->view('admin_link_update', $data);    }        public function create_action() {        if( ! $this->input->is_ajax_request() ) {            show_404();        }        $name = $this->input->post('name', true);        $link = $this->input->post('link', true);        $info = $this->input->post('info', true);        $sort = (int) $this->input->post('sort');        $data['name'] = trim($name);        $data['link'] = $link;        $data['info'] = substring(format_content($info), 240);        $data['sort'] = ($sort > 255) ? 255 : $sort;        $data['created'] = time();                if( ! $data['name'] OR ! $data['link'] ) {            JSON('error', '对不起，请填写必填字段！');        }                if( ! is_url($data['link']) ) {            JSON('error', '请填写有效的网站 URL 地址！');        }        $this->db->insert('link', $data);        if ( $this->db->insert_id() ) {            JSON('success', '恭喜，链接已添加成功！');        } else {            JSON('error', '添加失败，请重试！');        }    }        public function update_action() {        if( ! $this->input->is_ajax_request() ) {            show_404();        }        $name = $this->input->post('name', true);        $link = $this->input->post('link', true);        $info = $this->input->post('info', true);        $sort = (int) $this->input->post('sort');        $data['name'] = trim($name);        $data['link'] = $link;        $data['info'] = substring(format_content($info), 240);        $data['sort'] = ($sort > 255) ? 255 : $sort;                if( ! $data['name'] OR ! $data['link'] ) {            JSON('error', '对不起，请填写必填字段！');        }                if( ! is_url($data['link']) ) {            JSON('error', '请填写有效的网站 URL 地址！');        }                $lid = (int) $this->input->post('lid');                $this->db->update('link', $data, array('lid'=>$lid));        if ( $this->db->affected_rows() ) {            JSON('success', '恭喜，链接已更新成功！');        } else {            JSON('error', '对不起，链接没有更新名更新失败！');        }    }        public function delete_action() {        if( ! $this->input->is_ajax_request() ) {            show_404();        }                $lid = (int) $this->input->get('lid');                if( $this->link_model->delete_by_lid($lid) ) {            JSON('success', '该链接已成功删除');        } else {            JSON('error', '删除失败，请重试');        }    }}/* End of file link.php *//* Location: ./application/controllers/link.php */